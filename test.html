<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Eclipse Commander</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #0f172a;
            color: #f8fafc;
        }
        .btn {
            padding: 12px 24px;
            margin: 10px;
            font-size: 16px;
            cursor: pointer;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
        }
        .btn:hover {
            background: #2563eb;
        }
        #output {
            margin-top: 20px;
            padding: 15px;
            background: #1e293b;
            border-radius: 8px;
            min-height: 100px;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <h1>ðŸ§ª Eclipse Commander - Test FunzionalitÃ </h1>
    
    <div>
        <button class="btn" onclick="testConfig()">Test CONFIG</button>
        <button class="btn" onclick="testUtils()">Test Utils</button>
        <button class="btn" onclick="testStorage()">Test Storage</button>
        <button class="btn" onclick="testEclipseDB()">Test EclipseDB</button>
        <button class="btn" onclick="testLocationManager()">Test LocationManager</button>
    </div>
    
    <div id="output">
        <p>Click sui pulsanti per testare i moduli...</p>
    </div>
    
    <!-- Scripts in ordine -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/eclipse-database.js"></script>
    <script src="js/core/astronomy-calculator.js"></script>
    <script src="js/core/location-manager.js"></script>
    <script src="js/core/time-calculator.js"></script>
    
    <script>
        const output = document.getElementById('output');
        
        function log(msg, type = 'info') {
            const p = document.createElement('p');
            p.className = type;
            p.textContent = msg;
            output.appendChild(p);
        }
        
        function clear() {
            output.innerHTML = '';
        }
        
        function testConfig() {
            clear();
            log('=== TEST CONFIG ===');
            if (typeof CONFIG !== 'undefined') {
                log('âœ“ CONFIG caricato', 'success');
                log('Versione: ' + CONFIG.VERSION);
                log('Porte Ekos: ' + CONFIG.EKOS_DEFAULT_PORT);
                log('Porte N.I.N.A.: ' + CONFIG.NINA_DEFAULT_PORT);
            } else {
                log('âœ— CONFIG NON TROVATO', 'error');
            }
        }
        
        function testUtils() {
            clear();
            log('=== TEST UTILS ===');
            if (typeof Utils !== 'undefined') {
                log('âœ“ Utils caricato', 'success');
                const now = new Date();
                log('formatTime: ' + Utils.formatTime(now));
                log('formatDate: ' + Utils.formatDate(now));
                log('degreesToDMS(44.1393): ' + Utils.degreesToDMS(44.1393));
            } else {
                log('âœ— Utils NON TROVATO', 'error');
            }
        }
        
        function testStorage() {
            clear();
            log('=== TEST STORAGE ===');
            if (typeof Storage !== 'undefined') {
                log('âœ“ Storage caricato', 'success');
                
                // Test save/load
                Storage.saveSettings({test: 'value'});
                const settings = Storage.loadSettings();
                log('Test save/load: ' + JSON.stringify(settings));
            } else {
                log('âœ— Storage NON TROVATO', 'error');
            }
        }
        
        async function testEclipseDB() {
            clear();
            log('=== TEST ECLIPSE DATABASE ===');
            if (typeof eclipseDB !== 'undefined') {
                log('âœ“ eclipseDB caricato', 'success');
                log('Caricamento database...');
                
                try {
                    await eclipseDB.load();
                    log('âœ“ Database caricato!', 'success');
                    log('Eclissi totali: ' + eclipseDB.eclipses.length);
                    
                    if (eclipseDB.eclipses.length > 0) {
                        const first = eclipseDB.eclipses[0];
                        log('Prima eclissi: ' + first.id + ' - ' + first.name);
                    }
                } catch (error) {
                    log('âœ— Errore caricamento: ' + error.message, 'error');
                }
            } else {
                log('âœ— eclipseDB NON TROVATO', 'error');
            }
        }
        
        async function testLocationManager() {
            clear();
            log('=== TEST LOCATION MANAGER ===');
            if (typeof locationManager !== 'undefined') {
                log('âœ“ locationManager caricato', 'success');
                
                // Test set location
                const testLoc = {
                    lat: 44.1393,
                    lon: 12.2433,
                    name: 'Cervia, Italy'
                };
                
                locationManager.setLocation(testLoc);
                log('Location impostata: ' + testLoc.name);
                
                const current = locationManager.getCurrentLocation();
                log('Location corrente: ' + JSON.stringify(current));
                
            } else {
                log('âœ— locationManager NON TROVATO', 'error');
            }
        }
        
        // Auto-test all'avvio
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('=== AUTO-TEST CARICAMENTO ===', 'success');
                log('CONFIG: ' + (typeof CONFIG !== 'undefined' ? 'âœ“' : 'âœ—'), 
                    typeof CONFIG !== 'undefined' ? 'success' : 'error');
                log('Utils: ' + (typeof Utils !== 'undefined' ? 'âœ“' : 'âœ—'),
                    typeof Utils !== 'undefined' ? 'success' : 'error');
                log('Storage: ' + (typeof Storage !== 'undefined' ? 'âœ“' : 'âœ—'),
                    typeof Storage !== 'undefined' ? 'success' : 'error');
                log('eclipseDB: ' + (typeof eclipseDB !== 'undefined' ? 'âœ“' : 'âœ—'),
                    typeof eclipseDB !== 'undefined' ? 'success' : 'error');
                log('locationManager: ' + (typeof locationManager !== 'undefined' ? 'âœ“' : 'âœ—'),
                    typeof locationManager !== 'undefined' ? 'success' : 'error');
            }, 500);
        });
    </script>
</body>
</html>
